!function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=12)}([function(e,t){e.exports=require("events")},function(e,t){e.exports=require("util")},function(e,t,i){var o=t.noop=function(){};function r(e,t,i){this.logFunction=i,this.identifier=e,this.uniqueID=t,this.buffer=[]}t.extend=function(e,t){for(var i in t)e[i]=t[i]},t.eventEmitterListenerCount=i(0).EventEmitter.listenerCount||function(e,t){return e.listeners(t).length},t.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function(e){return new Buffer(e)},t.bufferFromString=Buffer.from?Buffer.from:function(e,t){return new Buffer(e,t)},t.BufferingLogger=function(e,t){var n=i(4)(e);if(n.enabled){var s=new r(e,t,n),a=s.log.bind(s);return a.printOutput=s.printOutput.bind(s),a.enabled=n.enabled,a}return n.printOutput=o,n},r.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},r.prototype.clear=function(){return this.buffer=[],this},r.prototype.printOutput=function(e){e||(e=this.logFunction);var t=this.uniqueID;this.buffer.forEach((function(i){var o=i[0].toLocaleString(),r=i[1].slice(),n=r[0];null!=n&&(n="%s - %s - "+n.toString(),r.splice(0,1,n,o,t),e.apply(global,r))}))}},function(e,t,i){var o=i(1),r=i(2),n=i(0).EventEmitter,s=i(9),a=i(24),c=i(26).Validation,h=r.bufferAllocUnsafe,l=r.bufferFromString;var u="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),d=0;function f(e,t,i,o,c){if(this._debug=r.BufferingLogger("websocket:connection",++d),this._debug("constructor"),this._debug.enabled&&function(e,t){if(!e._debug.enabled)return;var i=t.emit;for(var o in t.emit=function(t){e._debug("||| Socket Event  '%s'",t),i.apply(this,arguments)},t)"function"==typeof t[o]&&-1===["emit"].indexOf(o)&&function(i){var o=t[i];t[i]="on"!==i?function(){return e._debug("||| Socket method called:  %s",i),o.apply(this,arguments)}:function(){return e._debug("||| Socket method called:  %s (%s)",i,arguments[0]),o.apply(this,arguments)}}(o)}(this,e),n.call(this),this._pingListenerCount=0,this.on("newListener",(function(e){"ping"===e&&this._pingListenerCount++})).on("removeListener",(function(e){"ping"===e&&this._pingListenerCount--})),this.config=c,this.socket=e,this.protocol=i,this.extensions=t,this.remoteAddress=e.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=o,this.maskBytes=h(4),this.frameHeader=h(10),this.bufferList=new a,this.currentFrame=new s(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state="open",this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function p(e){return!(e<1e3)&&(e>=1e3&&e<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014].indexOf(e):e>=3e3&&e<=3999||(e>=4e3&&e<=4999||!(e>=5e3)&&void 0))}f.CLOSE_REASON_NORMAL=1e3,f.CLOSE_REASON_GOING_AWAY=1001,f.CLOSE_REASON_PROTOCOL_ERROR=1002,f.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,f.CLOSE_REASON_RESERVED=1004,f.CLOSE_REASON_NOT_PROVIDED=1005,f.CLOSE_REASON_ABNORMAL=1006,f.CLOSE_REASON_INVALID_DATA=1007,f.CLOSE_REASON_POLICY_VIOLATION=1008,f.CLOSE_REASON_MESSAGE_TOO_BIG=1009,f.CLOSE_REASON_EXTENSION_REQUIRED=1010,f.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,f.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,f.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},o.inherits(f,n),f.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},f.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},f.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},f.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},f.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},f.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},f.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(f.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},f.prototype.handleSocketData=function(e){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(e),this.processReceivedData()},f.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var e=this.currentFrame;if(e.addData(this.bufferList)){var t=this;if(e.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,e.dropReason)}));if(e.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,e.dropReason)}));if(e.rsv1||e.rsv2||e.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){t.emit("frame",e)}))),process.nextTick((function(){t.processFrame(e)})),this.currentFrame=new s(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&u(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},f.prototype.handleSocketError=function(e){this._debug("handleSocketError: %j",e),"closed"!==this.state?(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+e.syscall+" "+e.code,this.connected=!1,this.state="closed",this.fragmentationSize=0,r.eventEmitterListenerCount(this,"error")>0&&this.emit("error",e),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},f.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,"closed"!==this.state?"peer_requested_close"!==this.state&&"ending"!==this.state&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},f.prototype.handleSocketClose=function(e){this._debug("handleSocketClose: received socket close"),this.socketHadError=e,this.connected=!1,this.state="closed",-1===this.closeReasonCode&&(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},f.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},f.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},f.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},f.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},f.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},f.prototype.close=function(e,t){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),!p(e))throw new Error("Close code "+e+" is not valid.");"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this.closeReasonCode=e,this.closeDescription=t,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state="ending",this.connected=!1}},f.prototype.drop=function(e,t,i){this._debug("drop"),"number"!=typeof e&&(e=f.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",i,e,t),this.closeReasonCode=e,this.closeDescription=t,this.frameQueue=[],this.fragmentationSize=0,i||this.sendCloseFrame(e,t),this.connected=!1,this.state="closed",this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},f.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},f.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},f.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state="closed",this.socket.end())},f.prototype.processFrame=function(e){if(this._debug("processFrame"),this._debug(" -- frame: %s",e),0!==this.frameQueue.length&&e.opcode>0&&e.opcode<8)this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+e.opcode.toString(16)+" received in middle of fragmented message.");else switch(e.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(e.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:e.binaryPayload})):(this.frameQueue.push(e),this.fragmentationSize=e.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(e.fin){if(!c.isValidUTF8(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:e.binaryPayload.toString("utf8")})}else this.frameQueue.push(e),this.fragmentationSize=e.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=e.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(e),e.fin){var t=0,i=h(this.fragmentationSize),o=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(e){e.binaryPayload.copy(i,t),t+=e.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,o){case 2:this.emit("message",{type:"binary",binaryData:i});break;case 1:if(!c.isValidUTF8(i))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:i.toString("utf8")});break;default:return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+o.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var r=!1;this.emit("ping",(function(){r=!0}),e.binaryPayload),r||this.pong(e.binaryPayload)}else this.pong(e.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",e.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state="closed",void this.socket.end();var n;if(this._debug("---- Closing handshake initiated by peer."),this.state="peer_requested_close",e.invalidCloseFrameLength?(this.closeReasonCode=1005,n=f.CLOSE_REASON_PROTOCOL_ERROR):-1===e.closeStatus||p(e.closeStatus)?(this.closeReasonCode=e.closeStatus,n=f.CLOSE_REASON_NORMAL):(this.closeReasonCode=e.closeStatus,n=f.CLOSE_REASON_PROTOCOL_ERROR),e.binaryPayload.length>1){if(!c.isValidUTF8(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=e.binaryPayload.toString("utf8")}else this.closeDescription=f.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,e.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(n,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",e.opcode),this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+e.opcode.toString(16))}},f.prototype.send=function(e,t){if(this._debug("send"),Buffer.isBuffer(e))this.sendBytes(e,t);else{if("function"!=typeof e.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(e,t)}},f.prototype.sendUTF=function(e,t){e=l(e.toString(),"utf8"),this._debug("sendUTF: %d bytes",e.length);var i=new s(this.maskBytes,this.frameHeader,this.config);i.opcode=1,i.binaryPayload=e,this.fragmentAndSend(i,t)},f.prototype.sendBytes=function(e,t){if(this._debug("sendBytes"),!Buffer.isBuffer(e))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var i=new s(this.maskBytes,this.frameHeader,this.config);i.opcode=2,i.binaryPayload=e,this.fragmentAndSend(i,t)},f.prototype.ping=function(e){this._debug("ping");var t=new s(this.maskBytes,this.frameHeader,this.config);t.opcode=9,t.fin=!0,e&&(Buffer.isBuffer(e)||(e=l(e.toString(),"utf8")),e.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e),this.sendFrame(t)},f.prototype.pong=function(e){this._debug("pong");var t=new s(this.maskBytes,this.frameHeader,this.config);t.opcode=10,Buffer.isBuffer(e)&&e.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e,t.fin=!0,this.sendFrame(t)},f.prototype.fragmentAndSend=function(e,t){if(this._debug("fragmentAndSend"),e.opcode>7)throw new Error("You cannot fragment control frames.");var i=this.config.fragmentationThreshold,o=e.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||e.binaryPayload&&o<=i)return e.fin=!0,void this.sendFrame(e,t);for(var r=Math.ceil(o/i),n=0,a=function(e){e?"function"==typeof t&&(t(e),t=null):++n===r&&"function"==typeof t&&t()},c=1;c<=r;c++){var h=new s(this.maskBytes,this.frameHeader,this.config);h.opcode=1===c?e.opcode:0,h.fin=c===r;var l=c===r?o-i*(c-1):i,u=i*(c-1);h.binaryPayload=e.binaryPayload.slice(u,u+l),this.sendFrame(h,a)}},f.prototype.sendCloseFrame=function(e,t,i){if("number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,e,t),"open"===this.state||"peer_requested_close"===this.state){var o=new s(this.maskBytes,this.frameHeader,this.config);o.fin=!0,o.opcode=8,o.closeStatus=e,"string"==typeof t&&(o.binaryPayload=l(t,"utf8")),this.sendFrame(o,i),this.socket.end()}},f.prototype.sendFrame=function(e,t){this._debug("sendFrame"),e.mask=this.maskOutgoingPackets;var i=this.socket.write(e.toBuffer(),t);return this.outputBufferFull=!i,i},e.exports=f},function(e,t,i){"undefined"!=typeof process&&"renderer"===process.type?e.exports=i(16):e.exports=i(18)},function(e,t,i){var o;function r(e){function i(){if(i.enabled){var e=i,r=+new Date,n=r-(o||r);e.diff=n,e.prev=o,e.curr=r,o=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(i,o){if("%%"===i)return i;c++;var r=t.formatters[o];if("function"==typeof r){var n=s[c];i=r.call(e,n),s.splice(c,1),c--}return i})),t.formatArgs.call(e,s);var h=i.log||t.log||console.log.bind(console);h.apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var i,o=0;for(i in e)o=(o<<5)-o+e.charCodeAt(i),o|=0;return t.colors[Math.abs(o)%t.colors.length]}(e),"function"==typeof t.init&&t.init(i),i}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var i=("string"==typeof e?e:"").split(/[\s,]+/),o=i.length,r=0;r<o;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var i,o;for(i=0,o=t.skips.length;i<o;i++)if(t.skips[i].test(e))return!1;for(i=0,o=t.names.length;i<o;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=i(17),t.names=[],t.skips=[],t.formatters={}},function(e,t,i){for(var o=i(7),r=i(1),n=i(8),s=i(0).EventEmitter,a=i(3),c=/,\s*/,h=/;\s*/,l=/[\r\n]/g,u=/,\s*/,d=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],f=[String.fromCharCode(127)],p=0;p<31;p++)f.push(String.fromCharCode(p));var g=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,m=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,v=/^"[^"]*"$/,b=/[\x00-\x20\x3b]/g,y=/[;,] */,S={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function _(e,t,i){s.call(this),this.socket=e,this.httpRequest=t,this.resource=t.url,this.remoteAddress=e.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=i,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function E(e){process.nextTick((function(){e.drop(1006,"TCP connection lost before handshake completed.",!0)}))}r.inherits(_,s),_.prototype.readHandshake=function(){var e=this,t=this.httpRequest;if(this.resourceURL=n.parse(this.resource,!0),this.host=t.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=t.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(t.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var i=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw i.httpCode=426,i.headers={"Sec-WebSocket-Version":"13"},i}13===this.webSocketVersion?this.origin=t.headers.origin:8===this.webSocketVersion&&(this.origin=t.headers["sec-websocket-origin"]);var o=t.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],o)&&o.split(c).forEach((function(t){var i=t.toLocaleLowerCase();e.requestedProtocols.push(i),e.protocolFullCaseMap[i]=t}));if(!this.serverConfig.ignoreXForwardedFor&&t.headers["x-forwarded-for"]){var r=this.remoteAddress;this.remoteAddresses=t.headers["x-forwarded-for"].split(u),this.remoteAddresses.push(r),this.remoteAddress=this.remoteAddresses[0]}var s=t.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(s);var a=t.headers.cookie;this.cookies=this.parseCookies(a)},_.prototype.parseExtensions=function(e){if(!e||0===e.length)return[];var t=e.toLocaleLowerCase().split(c);return t.forEach((function(e,t,i){var o=e.split(h),r=o[0],n=o.slice(1);n.forEach((function(e,t,i){var o=e.split("="),r={name:o[0],value:o[1]};i.splice(t,1,r)}));var s={name:r,params:n};i.splice(t,1,s)})),t},_.prototype.parseCookies=function(e){if(!e||"string"!=typeof e)return[];var t=[];return e.split(y).forEach((function(e){var i=e.indexOf("=");if(-1!==i){var o=e.substr(0,i).trim(),r=e.substr(++i,e.length).trim();'"'===r[0]&&(r=r.slice(1,-1)),t.push({name:o,value:decodeURIComponent(r)})}else t.push({name:e,value:null})})),t},_.prototype.accept=function(e,t,i){var r;this._verifyResolution(),e?void 0===(r=this.protocolFullCaseMap[e.toLocaleLowerCase()])&&(r=e):r=e,this.protocolFullCaseMap=null;var n=o.createHash("sha1");n.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var s="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+n.digest("base64")+"\r\n";if(r){for(var c=0;c<r.length;c++){var h=r.charCodeAt(c),u=r.charAt(c);if(h<33||h>126||-1!==d.indexOf(u))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(u)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(e))throw this.reject(500),new Error("Specified protocol was not requested by the client.");r=r.replace(l,""),s+="Sec-WebSocket-Protocol: "+r+"\r\n"}if(this.requestedProtocols=null,t&&(t=t.replace(l,""),13===this.webSocketVersion?s+="Origin: "+t+"\r\n":8===this.webSocketVersion&&(s+="Sec-WebSocket-Origin: "+t+"\r\n")),i){if(!Array.isArray(i))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var f={};i.forEach(function(e){if(!e.name||!e.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(e.name=e.name.replace(b,""),e.value=e.value.replace(b,""),f[e.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");f[e.name]=!0;var t=e.name.match(g);if(t)throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie name");if(t=e.value.match(v)?e.value.slice(1,-1).match(m):e.value.match(m))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie value");var i=[e.name+"="+e.value];if(e.path){if(t=e.path.match(b))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie path");i.push("Path="+e.path)}if(e.domain){if("string"!=typeof e.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(t=e.domain.match(b))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie domain");i.push("Domain="+e.domain.toLowerCase())}if(e.expires){if(!(e.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');i.push("Expires="+e.expires.toGMTString())}if(e.maxage){var o=e.maxage;if("string"==typeof o&&(o=parseInt(o,10)),isNaN(o)||o<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');o=Math.round(o),i.push("Max-Age="+o.toString(10))}if(e.secure){if("boolean"!=typeof e.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');i.push("Secure")}if(e.httponly){if("boolean"!=typeof e.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');i.push("HttpOnly")}s+="Set-Cookie: "+i.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),s+="\r\n";var p=new a(this.socket,[],e,!1,this.serverConfig);p.webSocketVersion=this.webSocketVersion,p.remoteAddress=this.remoteAddress,p.remoteAddresses=this.remoteAddresses;var y=this;return this._socketIsClosing?E(p):this.socket.write(s,"ascii",(function(e){e?E(p):(y._removeSocketCloseListeners(),p._addSocketEventListeners())})),this.emit("requestAccepted",p),p},_.prototype.reject=function(e,t,i){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof e&&(e=403);var o="HTTP/1.1 "+e+" "+S[e]+"\r\nConnection: close\r\n";if(t&&(o+="X-WebSocket-Reject-Reason: "+(t=t.replace(l,""))+"\r\n"),i)for(var r in i){var n=i[r].toString().replace(l,"");o+=r.replace(l,"")+": "+n+"\r\n"}o+="\r\n",this.socket.end(o,"ascii"),this.emit("requestRejected",this)},_.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},_.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},_.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},e.exports=_},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("url")},function(e,t,i){var o=i(22).BufferUtil,r=i(2).bufferAllocUnsafe;function n(e,t,i){this.maskBytes=e,this.frameHeader=t,this.config=i,this.maxReceivedFrameSize=i.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}n.prototype.addData=function(e){if(1===this.parseState&&e.length>=2){e.joinInto(this.frameHeader,0,0,2),e.advance(2);var t=this.frameHeader[0],i=this.frameHeader[1];if(this.fin=Boolean(128&t),this.rsv1=Boolean(64&t),this.rsv2=Boolean(32&t),this.rsv3=Boolean(16&t),this.mask=Boolean(128&i),this.opcode=15&t,this.length=127&i,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)e.length>=2&&(e.joinInto(this.frameHeader,2,0,2),e.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&e.length>=8){e.joinInto(this.frameHeader,2,0,8),e.advance(8);var n=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==n[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=n[1],this.parseState=4}if(4===this.parseState&&(this.mask?e.length>=4&&(e.joinInto(this.maskBytes,0,0,4),e.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=r(0),this.parseState=6,!0;if(e.length>=this.length)return this.binaryPayload=e.take(this.length),e.advance(this.length),this.mask&&o.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=r(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},n.prototype.throwAwayPayload=function(e){return e.length>=this.length&&(e.advance(this.length),this.parseState=6,!0)},n.prototype.toBuffer=function(e){var t,i,n,s=2,a=0,c=0;this.fin&&(a|=128),this.rsv1&&(a|=64),this.rsv2&&(a|=32),this.rsv3&&(a|=16),this.mask&&(c|=128),a|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(i=r(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(i,2)):this.binaryPayload?(i=this.binaryPayload,this.length=i.length):this.length=0,this.length<=125?c|=127&this.length:this.length>125&&this.length<=65535?(c|=126,s+=2):this.length>65535&&(c|=127,s+=8);var h=r(this.length+s+(this.mask?4:0));return h[0]=a,h[1]=c,n=2,this.length>125&&this.length<=65535?(h.writeUInt16BE(this.length,n),n+=2):this.length>65535&&(h.writeUInt32BE(0,n),h.writeUInt32BE(this.length,n+4),n+=8),this.mask?(t=e?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(t,0),this.maskBytes.copy(h,n),n+=4,i&&o.mask(i,this.maskBytes,h,n,this.length)):i&&i.copy(h,n),h},n.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},e.exports=n},function(e,t,i){var o=i(2),r=o.extend,n=i(1),s=i(0).EventEmitter,a=i(11),c=i(28),h=i(8),l=i(7),u=i(3),d=o.bufferAllocUnsafe,f=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],p=["hostname","port","method","path","headers"];function g(e){var t;(s.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},e)&&(e.tlsOptions?(t=e.tlsOptions,delete e.tlsOptions):t={},r(this.config,e),r(this.config.tlsOptions,t));switch(this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}n.inherits(g,s),g.prototype.connect=function(e,t,i,n,s){var l=this;if("string"==typeof t&&(t=t.length>0?[t]:[]),t instanceof Array||(t=[]),this.protocols=t,this.origin=i,this.url="string"==typeof e?h.parse(e):e,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(e){for(var t=0;t<e.length;t++){var i=e.charCodeAt(t),o=e.charAt(t);if(i<33||i>126||-1!==f.indexOf(o))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(i)+'"')}}));this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var u=d(16),g=0;g<16;g++)u[g]=Math.round(255*Math.random());this.base64nonce=u.toString("base64");var m=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(m+=":"+this.url.port);var v,b={};function y(e){l._req=null,l.emit("connectFailed",e)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&r(b,this.config.tlsOptions.headers),n&&r(b,n),r(b,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:b.Host||m}),this.protocols.length>0&&(b["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?b.Origin=this.origin:8===this.config.webSocketVersion&&(b["Sec-WebSocket-Origin"]=this.origin)),v=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var S={agent:!1};if(s&&r(S,s),r(S,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:v,headers:b}),this.secure){var _=this.config.tlsOptions;for(var E in _)_.hasOwnProperty(E)&&-1===p.indexOf(E)&&(S[E]=_[E])}var k=this._req=(this.secure?c:a).request(S);k.on("upgrade",(function(e,t,i){l._req=null,k.removeListener("error",y),l.socket=t,l.response=e,l.firstDataChunk=i,l.validateHandshake()})),k.on("error",y),k.on("response",(function(e){if(l._req=null,o.eventEmitterListenerCount(l,"httpResponse")>0)l.emit("httpResponse",e,l),e.socket&&e.socket.end();else{var t=[];for(var i in e.headers)t.push(i+": "+e.headers[i]);l.failHandshake("Server responded with a non-101 status: "+e.statusCode+" "+e.statusMessage+"\nResponse Headers Follow:\n"+t.join("\n")+"\n")}})),k.end()},g.prototype.validateHandshake=function(){var e=this.response.headers;if(this.protocols.length>0){if(this.protocol=e["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(e.connection&&"upgrade"===e.connection.toLocaleLowerCase())if(e.upgrade&&"websocket"===e.upgrade.toLocaleLowerCase()){var t=l.createHash("sha1");t.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var i=t.digest("base64");e["sec-websocket-accept"]?e["sec-websocket-accept"]===i?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+i):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},g.prototype.failHandshake=function(e){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(e))},g.prototype.succeedHandshake=function(){var e=new u(this.socket,[],this.protocol,!0,this.config);e.webSocketVersion=this.config.webSocketVersion,e._addSocketEventListeners(),this.emit("connect",e),this.firstDataChunk.length>0&&e.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},g.prototype.abort=function(){this._req&&this._req.abort()},e.exports=g},function(e,t){e.exports=require("http")},function(e,t,i){"use strict";process.title="node-chat";var o=i(13).server,r=i(11),n=[],s=[];function a(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var c=["red","green","blue","magenta","purple","plum","orange"];c.sort((function(e,t){return Math.random()>.5}));var h=r.createServer((function(e,t){console.log("Request",e)}));h.listen(1337,(function(){console.log(new Date+" Server is listening on port 1337")})),new o({httpServer:h}).on("request",(function(e){console.log(new Date+" Connection from origin "+e.origin+".");var t=e.accept(null,e.origin),i=s.push(t)-1,o=!1,r=!1;console.log(new Date+" Connection accepted."),n.length>0&&t.sendUTF(JSON.stringify({type:"history",data:n})),t.on("message",(function(e){if("utf8"===e.type)if(!1===o)o=a(e.utf8Data),r=c.shift(),console.log(new Date+" User is known as: "+o+" with "+r+" color.");else{console.log(new Date+" Received Message from "+o+": "+e.utf8Data);var t={time:(new Date).getTime(),text:a(e.utf8Data),author:o,color:r};n.push(t),n=n.slice(-100);for(var i=JSON.stringify({type:"message",data:t}),h=0;h<s.length;h++)s[h].sendUTF(i)}})),t.on("close",(function(e){!1!==o&&!1!==r&&(console.log(new Date+" Peer "+e.remoteAddress+" disconnected."),s.splice(i,1),c.push(r))}))}))},function(e,t,i){e.exports=i(14)},function(e,t,i){e.exports={server:i(15),client:i(10),router:i(29),frame:i(9),request:i(6),connection:i(3),w3cwebsocket:i(31),deprecation:i(37),version:i(38)}},function(e,t,i){var o=i(2).extend,r=i(2),n=i(1),s=i(4)("websocket:server"),a=i(0).EventEmitter,c=i(6),h=function(e){a.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],e&&this.mount(e)};n.inherits(h,a),h.prototype.mount=function(e){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,disableNagleAlgorithm:!0,closeTimeout:5e3},o(this.config,e),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var t=this._handlers.upgrade;this.config.httpServer.forEach((function(e){e.on("upgrade",t)}))},h.prototype.unmount=function(){var e=this._handlers.upgrade;this.config.httpServer.forEach((function(t){t.removeListener("upgrade",e)}))},h.prototype.closeAllConnections=function(){this.connections.forEach((function(e){e.close()})),this.pendingRequests.forEach((function(e){process.nextTick((function(){e.reject(503)}))}))},h.prototype.broadcast=function(e){Buffer.isBuffer(e)?this.broadcastBytes(e):"function"==typeof e.toString&&this.broadcastUTF(e)},h.prototype.broadcastUTF=function(e){this.connections.forEach((function(t){t.sendUTF(e)}))},h.prototype.broadcastBytes=function(e){this.connections.forEach((function(t){t.sendBytes(e)}))},h.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},h.prototype.handleUpgrade=function(e,t){var i=this,o=new c(t,e,this.config);try{o.readHandshake()}catch(e){return o.reject(e.httpCode?e.httpCode:400,e.message,e.headers),void s("Invalid handshake: %s",e.message)}this.pendingRequests.push(o),o.once("requestAccepted",this._handlers.requestAccepted),o.once("requestResolved",this._handlers.requestResolved),t.once("close",(function(){i._handlers.requestResolved(o)})),!this.config.autoAcceptConnections&&r.eventEmitterListenerCount(this,"request")>0?this.emit("request",o):this.config.autoAcceptConnections?o.accept(o.requestedProtocols[0],o.origin):o.reject(404,"No handler is configured to accept the connection.")},h.prototype.handleRequestAccepted=function(e){var t=this;e.once("close",(function(i,o){t.handleConnectionClose(e,i,o)})),this.connections.push(e),this.emit("connect",e)},h.prototype.handleConnectionClose=function(e,t,i){var o=this.connections.indexOf(e);-1!==o&&this.connections.splice(o,1),this.emit("close",e,t,i)},h.prototype.handleRequestResolved=function(e){var t=this.pendingRequests.indexOf(e);-1!==t&&this.pendingRequests.splice(t,1)},e.exports=h},function(e,t,i){function o(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=i(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var i=this.useColors;if(e[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+e[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),!i)return;var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(n=r))})),e.splice(n,0,o)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())},function(e,t){var i=1e3,o=6e4,r=60*o,n=24*r;function s(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}e.exports=function(e,t){t=t||{};var a,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*n;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*o;case"seconds":case"second":case"secs":case"sec":case"s":return s*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?s(a=e,n,"day")||s(a,r,"hour")||s(a,o,"minute")||s(a,i,"second")||a+" ms":function(e){if(e>=n)return Math.round(e/n)+"d";if(e>=r)return Math.round(e/r)+"h";if(e>=o)return Math.round(e/o)+"m";if(e>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,i){var o=i(19),r=i(1);(t=e.exports=i(5)).init=function(e){e.inspectOpts={};for(var i=Object.keys(t.inspectOpts),o=0;o<i.length;o++)e.inspectOpts[i[o]]=t.inspectOpts[i[o]]},t.log=function(){return s.write(r.format.apply(r,arguments)+"\n")},t.formatArgs=function(e){var i=this.namespace;if(this.useColors){var o=this.color,r="  [3"+o+";1m"+i+" [0m";e[0]=r+e[0].split("\n").join("\n"+r),e.push("[3"+o+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+i+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):o.isatty(n)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var i=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),o=process.env[t];return o=!!/^(yes|on|true|enabled)$/i.test(o)||!/^(no|off|false|disabled)$/i.test(o)&&("null"===o?null:Number(o)),e[i]=o,e}),{});var n=parseInt(process.env.DEBUG_FD,10)||2;1!==n&&2!==n&&r.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var s=1===n?process.stdout:2===n?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new o.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":var r=i(20);(t=new r.SyncWriteStream(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var n=i(21);(t=new n.Socket({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(n);function a(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)},t.enable(a())},function(e,t){e.exports=require("tty")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("net")},function(e,t,i){
    /*!
     * Copied from:
     * ws: a node.js websocket client
     * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
     * MIT Licensed
     */
    try{e.exports=i(!function(){var e=new Error("Cannot find module '../build/Release/bufferutil'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=i(!function(){var e=new Error("Cannot find module '../build/default/bufferutil'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=i(23)}catch(e){throw console.error("bufferutil.node seems to not have been built. Run npm install."),e}}}},function(e,t){
    /*!
     * Copied from:
     * ws: a node.js websocket client
     * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
     * MIT Licensed
     */
    e.exports.BufferUtil={merge:function(e,t){for(var i=0,o=0,r=t.length;o<r;++o){var n=t[o];n.copy(e,i),i+=n.length}},mask:function(e,t,i,o,r){for(var n=t.readUInt32LE(0),s=0;s<r-3;s+=4){var a=n^e.readUInt32LE(s);a<0&&(a=4294967296+a),i.writeUInt32LE(a,o+s)}switch(r%4){case 3:i[o+s+2]=e[s+2]^t[2];case 2:i[o+s+1]=e[s+1]^t[1];case 1:i[o+s]=e[s]^t[0]}},unmask:function(e,t){for(var i=t.readUInt32LE(0),o=e.length,r=0;r<o-3;r+=4){var n=i^e.readUInt32LE(r);n<0&&(n=4294967296+n),e.writeUInt32LE(n,r)}switch(o%4){case 3:e[r+2]=e[r+2]^t[2];case 2:e[r+1]=e[r+1]^t[1];case 1:e[r]=e[r]^t[0]}}}},function(e,t,i){var o=i(25).Buffer,r=i(0).EventEmitter,n=i(2).bufferAllocUnsafe;function s(e){if(!(this instanceof s))return new s(e);r.call(this);var t=this;void 0===e&&(e={}),t.encoding=e.encoding;var i={next:null,buffer:null},a={next:null,buffer:null},c=0;t.__defineGetter__("length",(function(){return c}));var h=0;t.write=function(e){return i.buffer?(a.next={next:null,buffer:e},a=a.next):(i.buffer=e,a=i),c+=e.length,t.emit("write",e),!0},t.end=function(e){o.isBuffer(e)&&t.write(e)},t.push=function(){var e=[].concat.apply([],arguments);return e.forEach(t.write),t},t.forEach=function(e){if(!i.buffer)return n(0);if(i.buffer.length-h<=0)return t;for(var o={buffer:i.buffer.slice(h),next:i.next};o&&o.buffer;){if(e(o.buffer))break;o=o.next}return t},t.join=function(e,o){if(!i.buffer)return n(0);null==e&&(e=0),null==o&&(o=t.length);var r=n(o-e),s=0;return t.forEach((function(t){if(e<s+t.length&&s<o&&t.copy(r,Math.max(0,s-e),Math.max(0,e-s),Math.min(t.length,o-s)),(s+=t.length)>o)return!0})),r},t.joinInto=function(e,o,r,s){if(!i.buffer)return new n(0);null==r&&(r=0),null==s&&(s=t.length);var a=e;if(a.length-o<s-r)throw new Error("Insufficient space available in target Buffer.");var c=0;return t.forEach((function(e){if(r<c+e.length&&c<s&&e.copy(a,Math.max(o,o+c-r),Math.max(0,r-c),Math.min(e.length,s-c)),(c+=e.length)>s)return!0})),a},t.advance=function(e){for(h+=e,c-=e;i.buffer&&h>=i.buffer.length;)h-=i.buffer.length,i=i.next?i.next:{buffer:null,next:null};return null===i.buffer&&(a={next:null,buffer:null}),t.emit("advance",e),t},t.take=function(e,i){null==e?e=t.length:"number"!=typeof e&&(i=e,e=t.length);if(i||(i=t.encoding),i){var o="";return t.forEach((function(t){if(e<=0)return!0;o+=t.toString(i,0,Math.min(e,t.length)),e-=t.length})),o}return t.join(0,e)},t.toString=function(){return t.take("binary")}}e.exports=s,e.exports.BufferList=s,i(1).inherits(s,r)},function(e,t){e.exports=require("buffer")},function(e,t,i){
    /*!
     * UTF-8 Validation Code originally from:
     * ws: a node.js websocket client
     * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
     * MIT Licensed
     */
    try{e.exports=i(!function(){var e=new Error("Cannot find module '../build/Release/validation'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=i(!function(){var e=new Error("Cannot find module '../build/default/validation'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=i(27)}catch(e){throw console.error("validation.node seems not to have been built. Run npm install."),e}}}},function(e,t){
    /*!
     * UTF-8 Validation Fallback Code originally from:
     * ws: a node.js websocket client
     * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
     * MIT Licensed
     */
    e.exports.Validation={isValidUTF8:function(){return!0}}},function(e,t){e.exports=require("https")},function(e,t,i){var o=i(2).extend,r=i(1),n=i(0).EventEmitter,s=i(30);function a(e){n.call(this),this.config={server:null},e&&o(this.config,e),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}r.inherits(a,n),a.prototype.attachServer=function(e){if(!e)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=e,this.server.on("request",this._requestHandler)},a.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},a.prototype.mount=function(e,t,i){if(!e)throw new Error("You must specify a path for this handler.");if(t||(t="____no_protocol____"),!i)throw new Error("You must specify a callback for this handler.");if(!((e=this.pathToRegExp(e))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var o=e.toString();if(t=t.toLocaleLowerCase(),-1!==this.findHandlerIndex(o,t))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:e,pathString:o,protocol:t,callback:i})},a.prototype.unmount=function(e,t){var i=this.findHandlerIndex(this.pathToRegExp(e).toString(),t);if(-1===i)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(i,1)},a.prototype.findHandlerIndex=function(e,t){t=t.toLocaleLowerCase();for(var i=0,o=this.handlers.length;i<o;i++){var r=this.handlers[i];if(r.pathString===e&&r.protocol===t)return i}return-1},a.prototype.pathToRegExp=function(e){return"string"==typeof e&&("*"===e?e=/^.*$/:(e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp("^"+e+"$"))),e},a.prototype.handleRequest=function(e){var t=e.requestedProtocols;0===t.length&&(t=["____no_protocol____"]);for(var i=0;i<t.length;i++)for(var o=t[i].toLocaleLowerCase(),r=0,n=this.handlers.length;r<n;r++){var a=this.handlers[r];if(a.path.test(e.resourceURL.pathname)&&(o===a.protocol||"*"===a.protocol)){var c=new s(e,o);return void a.callback(c)}}e.reject(404,"No handler is available for the given request.")},e.exports=a},function(e,t,i){var o=i(1),r=i(0).EventEmitter;function n(e,t){r.call(this),this.webSocketRequest=e,this.protocol="____no_protocol____"===t?null:t,this.origin=e.origin,this.resource=e.resource,this.resourceURL=e.resourceURL,this.httpRequest=e.httpRequest,this.remoteAddress=e.remoteAddress,this.webSocketVersion=e.webSocketVersion,this.requestedExtensions=e.requestedExtensions,this.cookies=e.cookies}o.inherits(n,r),n.prototype.accept=function(e,t){var i=this.webSocketRequest.accept(this.protocol,e,t);return this.emit("requestAccepted",i),i},n.prototype.reject=function(e,t,i){this.webSocketRequest.reject(e,t,i),this.emit("requestRejected",this)},e.exports=n},function(e,t,i){var o=i(10),r=i(32),n=i(34);const s=0,a=1,c=2,h=3;function l(e,t,i,r,a,c){n.EventTarget.call(this),(c=c||{}).assembleFragments=!0;var h=this;this._url=e,this._readyState=s,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new o(c),this._client.on("connect",(function(e){f.call(h,e)})),this._client.on("connectFailed",(function(){p.call(h)})),this._client.connect(e,t,i,r,a)}function u(e,t){var i=new n.Event("close");return i.code=e,i.reason=t,i.wasClean=void 0===e||1e3===e,i}function d(e){var t=new n.Event("message");return t.data=e,t}function f(e){var t=this;this._readyState=a,this._connection=e,this._protocol=e.protocol,this._extensions=e.extensions,this._connection.on("close",(function(e,i){g.call(t,e,i)})),this._connection.on("message",(function(e){m.call(t,e)})),this.dispatchEvent(new n.Event("open"))}function p(){v.call(this),this._readyState=h;try{this.dispatchEvent(new n.Event("error"))}finally{this.dispatchEvent(u(1006,"connection failed"))}}function g(e,t){v.call(this),this._readyState=h,this.dispatchEvent(u(e,t||""))}function m(e){if(e.utf8Data)this.dispatchEvent(d(e.utf8Data));else if(e.binaryData&&"arraybuffer"===this.binaryType){for(var t=e.binaryData,i=new ArrayBuffer(t.length),o=new Uint8Array(i),r=0,n=t.length;r<n;++r)o[r]=t[r];this.dispatchEvent(d(i))}}function v(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}e.exports=l,Object.defineProperties(l.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(l.prototype,{binaryType:{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=e}}}),[["CONNECTING",s],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(l.prototype,e[0],{get:function(){return e[1]}})})),[["CONNECTING",s],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(l,e[0],{get:function(){return e[1]}})})),l.prototype.send=function(e){if(this._readyState!==a)throw new Error("cannot call send() while not connected");if("string"==typeof e||e instanceof String)this._connection.sendUTF(e);else if(e instanceof Buffer)this._connection.sendBytes(e);else{if(!e.byteLength&&0!==e.byteLength)throw new Error("unknown binary data:",e);e=r(e),this._connection.sendBytes(e)}},l.prototype.close=function(e,t){switch(this._readyState){case s:p.call(this),this._client.on("connect",(function(i){e?i.close(e,t):i.close()}));break;case a:this._readyState=c,e?this._connection.close(e,t):this._connection.close()}}},function(e,t,i){var o=i(33).strict;e.exports=function(e){if(o(e)){var t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return Buffer.from(e)}},function(e,t){e.exports=r,r.strict=n,r.loose=s;var i=Object.prototype.toString,o={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function r(e){return n(e)||s(e)}function n(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return o[i.call(e)]}},function(e,t,i){e.exports={EventTarget:i(35),Event:i(36)}},function(e,t){function i(){"function"!=typeof this.addEventListener&&(this._listeners={},this.addEventListener=o,this.removeEventListener=r,this.dispatchEvent=n)}function o(e,t){var i,o,r;if(e&&t){for(void 0===(i=this._listeners[e])&&(this._listeners[e]=i=[]),o=0;r=i[o];o++)if(r===t)return;i.push(t)}}function r(e,t){var i,o,r;if(e&&t&&void 0!==(i=this._listeners[e])){for(o=0;r=i[o];o++)if(r===t){i.splice(o,1);break}0===i.length&&delete this._listeners[e]}}function n(e){var t,i,o,r,n,s=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){s=!0}}catch(e){}for(t=e.type,i=this._listeners[t]||[],"function"==typeof(o=this["on"+t])&&o.call(this,e),r=0;(n=i[r])&&!s;r++)n.call(this,e);return!e.defaultPrevented}e.exports=i,Object.defineProperties(i.prototype,{listeners:{get:function(){return this._listeners}}})},function(e,t){e.exports=function(e){this.type=e,this.isTrusted=!1,this._yaeti=!0}},function(e,t){var i={disableWarnings:!1,deprecationWarningMap:{},warn:function(e){!this.disableWarnings&&this.deprecationWarningMap[e]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[e]),this.deprecationWarningMap[e]=!1)}};e.exports=i},function(e,t,i){e.exports=i(39).version},function(e){e.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.31","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=0.10.0"},"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')}]);
